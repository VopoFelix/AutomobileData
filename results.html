<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Automobile-Data — Suchergebnisse</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f9f9f9;color:#222}
    header{background:#333;color:#fff;padding:18px;text-align:center;font-weight:700}
    .page{max-width:1100px;margin:20px auto;padding:0 12px}
    .search-bar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-bottom:18px}
    .search-bar input[type="text"]{padding:10px;min-width:180px;border:1px solid #ccc;border-radius:6px;font-size:14px}
    .search-bar button{background:#333;color:#fff;border:none;padding:10px 14px;border-radius:6px;cursor:pointer}
    .search-bar button:hover{background:#555}
    .controls{display:flex;gap:12px;align-items:center;justify-content:center;margin-bottom:18px;flex-wrap:wrap}
    .controls select{padding:8px;border-radius:6px;border:1px solid #ccc}
    .results-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:15px;margin-bottom:24px}
    .card{background:#fff;border:1px solid #e0e0e0;border-radius:8px;padding:14px;box-shadow:0 2px 6px rgba(0,0,0,0.04);display:flex;flex-direction:column;justify-content:space-between}
    .card h3{margin:0 0 8px 0;font-size:18px}
    .card p{margin:4px 0;color:#444}
    .actions{margin-top:10px;display:flex;gap:8px;justify-content:flex-end}
    .btn{padding:8px 12px;border-radius:6px;border:none;cursor:pointer;background:#333;color:#fff}
    .btn.secondary{background:#eee;color:#222;border:1px solid #ccc}
    .btn.secondary:hover{background:#ddd}
    .back{display:block;margin:8px auto 40px auto;padding:10px 18px;border-radius:6px;background:#ddd;border:none;cursor:pointer}
    .back:hover{background:#ccc}
    @media (max-width:520px){.search-bar input[type="text"]{min-width:120px}}
  </style>
</head>
<body>
  <header>Automobile-Data</header>

  <main class="page">
    <div class="search-bar" role="search" aria-label="Filters">
      <input type="text" id="marke" placeholder="Marke" />
      <input type="text" id="modell" placeholder="Modell" />
      <input type="text" id="baujahr" placeholder="Baujahr" />
      <input type="text" id="kraftstoff" placeholder="Kraftstoffart" />
      <button id="searchBtn">Suchen</button>
    </div>

    <div class="controls" aria-label="Sortierung">
      <label><strong>Sortieren nach:</strong>
        <select id="sortField">
          <option value="alphabet">Alphabet (Marke + Modell)</option>
          <option value="baujahr">Baujahr</option>
          <option value="ps">PS</option>
        </select>
      </label>

      <label><strong>Reihenfolge:</strong>
        <select id="sortOrder">
          <option value="asc">Aufsteigend</option>
          <option value="desc">Absteigend</option>
        </select>
      </label>

      <button id="applySortBtn" class="btn secondary">Sortieren</button>
    </div>

    <section id="resultsSection">
      <div id="results" class="results-grid" aria-live="polite"></div>
    </section>

    <button class="back" onclick="history.back()">Zurück</button>
  </main>

  <script>
    /***** EINGEBETTETE TEST-DATEN (funktioniert sofort) *****/
    const cars = [
      { id:1, marke:"Audi", modell:"A6", baujahr:2021, kraftstoff:"Hybrid", ps:245 },
      { id:2, marke:"VW", modell:"Golf", baujahr:2017, kraftstoff:"Benzin", ps:110 },
      { id:3, marke:"BMW", modell:"320i", baujahr:2016, kraftstoff:"Benzin", ps:170 },
      { id:4, marke:"Mercedes", modell:"C200", baujahr:2019, kraftstoff:"Diesel", ps:160 },
      { id:5, marke:"Audi", modell:"Q5", baujahr:2020, kraftstoff:"Benzin", ps:249 },
      { id:6, marke:"VW", modell:"Passat", baujahr:2018, kraftstoff:"Diesel", ps:190 },
      { id:7, marke:"BMW", modell:"X3", baujahr:2021, kraftstoff:"Hybrid", ps:292 },
      { id:8, marke:"Mercedes", modell:"E200", baujahr:2020, kraftstoff:"Benzin", ps:184 }
    ];

    // Wenn du stattdessen externen autos.js nutzt: setze window.autos = [...] in autos.js
    const autos = (window.autos && Array.isArray(window.autos) && window.autos.length) ? window.autos : cars;

    /***** Helfer ******/
    function getQueryParams() {
      const params = {};
      const qs = window.location.search.substring(1);
      if (!qs) return params;
      qs.split("&").forEach(pair => {
        const [k,v] = pair.split("=");
        if (k) params[decodeURIComponent(k)] = decodeURIComponent(v || "");
      });
      return params;
    }
    function saveFiltersToStorage(f){ try{ localStorage.setItem("autoFilters", JSON.stringify(f)); }catch(e){} }
    function loadFiltersFromStorage(){ try{ return JSON.parse(localStorage.getItem("autoFilters")||"{}"); }catch(e){return{}} }

    /***** Filter / Sort / Render *****/
    let currentResults = [];

    function applyFiltersFromUrlOrStorage() {
      const params = getQueryParams();
      const st = loadFiltersFromStorage();

      const marke = params.marke !== undefined ? params.marke : (document.getElementById("marke").value || st.marke || "");
      const modell = params.modell !== undefined ? params.modell : (document.getElementById("modell").value || st.modell || "");
      const baujahr = params.baujahr !== undefined ? params.baujahr : (document.getElementById("baujahr").value || st.baujahr || "");
      const kraftstoff = params.kraftstoff !== undefined ? params.kraftstoff : (document.getElementById("kraftstoff").value || st.kraftstoff || "");

      document.getElementById("marke").value = marke;
      document.getElementById("modell").value = modell;
      document.getElementById("baujahr").value = baujahr;
      document.getElementById("kraftstoff").value = kraftstoff;
    }

    function filterCars() {
      const marke = document.getElementById("marke").value.trim().toLowerCase();
      const modell = document.getElementById("modell").value.trim().toLowerCase();
      const baujahr = document.getElementById("baujahr").value.trim();
      const kraftstoff = document.getElementById("kraftstoff").value.trim().toLowerCase();

      return autos.filter(a => {
        if (marke && !(a.marke && a.marke.toLowerCase().includes(marke))) return false;
        if (modell && !(a.modell && a.modell.toLowerCase().includes(modell))) return false;
        if (baujahr && String(a.baujahr) !== baujahr) return false;
        if (kraftstoff && !(a.kraftstoff && a.kraftstoff.toLowerCase().includes(kraftstoff))) return false;
        return true;
      });
    }

    function displayResults(list) {
      const container = document.getElementById("results");
      container.innerHTML = "";
      if (!list || list.length === 0) {
        container.innerHTML = `<div style="grid-column:1/-1;padding:20px;text-align:center;background:#fff;border:1px solid #eee;border-radius:8px">Keine Ergebnisse gefunden.</div>`;
        return;
      }
      list.forEach(car => {
        const card = document.createElement("article");
        card.className = "card";
        card.innerHTML = `
          <div>
            <h3>${escapeHtml(car.marke||"-")} ${escapeHtml(car.modell||"")}</h3>
            <p><strong>Baujahr:</strong> ${escapeHtml(String(car.baujahr||"-"))}</p>
            <p><strong>PS:</strong> ${escapeHtml(String(car.ps||"-"))}</p>
            <p><strong>Kraftstoff:</strong> ${escapeHtml(car.kraftstoff||"-")}</p>
          </div>
          <div class="actions">
            <button class="btn secondary" onclick="viewDetails(${encodeURIComponent(car.id)})">Details</button>
          </div>`;
        container.appendChild(card);
      });
    }
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    function applySortingAndDisplay() {
      const field = document.getElementById("sortField").value;
      const order = document.getElementById("sortOrder").value;
      let list = [...currentResults];
      if (field === "alphabet") {
        list.sort((a,b)=>((a.marke||"")+" "+(a.modell||"")).localeCompare((b.marke||"")+" "+(b.modell||"")));
      } else if (field === "baujahr") {
        list.sort((a,b)=> (Number(a.baujahr)||0) - (Number(b.baujahr)||0) );
      } else if (field === "ps") {
        list.sort((a,b)=> (Number(a.ps)||0) - (Number(b.ps)||0) );
      }
      if (order === "desc") list.reverse();
      displayResults(list);
    }

    function viewDetails(id){
      // speichern, damit beim Zurückkehren Zustand erhalten bleibt
      saveFiltersToStorage({
        marke: document.getElementById("marke").value,
        modell: document.getElementById("modell").value,
        baujahr: document.getElementById("baujahr").value,
        kraftstoff: document.getElementById("kraftstoff").value,
        sortField: document.getElementById("sortField").value,
        sortOrder: document.getElementById("sortOrder").value
      });
      window.location.href = "details.html?id=" + encodeURIComponent(id);
    }

    // Init / Event hookup
    document.addEventListener("DOMContentLoaded", () => {
      applyFiltersFromUrlOrStorage();            // inputfelder setzen (URL hat Vorrang)
      currentResults = filterCars();            // filtern (initial)
      // defaults aus storage (falls vorhanden)
      const st = loadFiltersFromStorage();
      document.getElementById("sortField").value = st.sortField || "alphabet";
      document.getElementById("sortOrder").value = st.sortOrder || "asc";
      applySortingAndDisplay();

      document.getElementById("searchBtn").addEventListener("click", ()=>{
        currentResults = filterCars();
        applySortingAndDisplay();
      });
      document.getElementById("applySortBtn").addEventListener("click", ()=>{
        currentResults = filterCars();
        applySortingAndDisplay();
        saveFiltersToStorage(Object.assign(loadFiltersFromStorage(), {
          sortField: document.getElementById("sortField").value,
          sortOrder: document.getElementById("sortOrder").value
        }));
      });

      // Enter in Inputs = Suche
      ['marke','modell','baujahr','kraftstoff'].forEach(id=>{
        document.getElementById(id).addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); currentResults = filterCars(); applySortingAndDisplay(); }});
      });
    });
  </script>
</body>
</html>
