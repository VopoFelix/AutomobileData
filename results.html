<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Suchergebnisse</title>
    <style>
        body { font-family: Arial, sans-serif; margin:20px; background-color:#f0f0f5; }
        header { background-color:#333; color:white; padding:20px; text-align:center; }
        .filter-bar { background-color:white; padding:20px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin-bottom:20px; }
        input, button { padding:6px; }
        ul { list-style-type:none; padding:0; max-width:800px; margin:auto; }
        li { background-color:white; margin:10px 0; padding:15px; border-radius:8px; cursor:pointer; box-shadow:0 0 5px rgba(0,0,0,0.1); }
        li:hover { background-color:#e0e0ff; }
        button.back { margin-bottom:20px; padding:10px 20px; cursor:pointer; display:block; }
    </style>
</head>
<body>
    <header>
        <h1>Suchergebnisse</h1>
    </header>

<style>
.back {
    display:block;
    margin:20px auto;
    padding:10px 20px;
    cursor:pointer;
}
</style>

<body>
</header>

<button class="back" onclick="window.history.back()">Zur√ºck</button>

    <div class="filter-bar">
        <input list="markenList" id="marke" placeholder="Marke">
        <datalist id="markenList"></datalist>

        <input list="modelleList" id="modell" placeholder="Modell">
        <datalist id="modelleList"></datalist>

        <input list="baujahrList" id="baujahr" placeholder="Baujahr">
        <datalist id="baujahrList"></datalist>

        <input list="kraftstoffList" id="kraftstoff" placeholder="Kraftstoffart">
        <datalist id="kraftstoffList"></datalist>

        <button id="filterBtn">Filtern</button>
    </div>

    <ul id="results"></ul>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let autos = [];

            const params = new URLSearchParams(window.location.search);
            const markeInput = document.getElementById('marke');
            const modellInput = document.getElementById('modell');
            const baujahrInput = document.getElementById('baujahr');
            const kraftstoffInput = document.getElementById('kraftstoff');

            const markenList = document.getElementById('markenList');
            const modelleList = document.getElementById('modelleList');
            const baujahrList = document.getElementById('baujahrList');
            const kraftstoffList = document.getElementById('kraftstoffList');

            const resultsUl = document.getElementById('results');
            const filterBtn = document.getElementById('filterBtn');

            fetch('autos.json')
                .then(response => response.json())
                .then(data => {
                    autos = data;

                    populateDatalists();
                    applyInitialParams();
                    renderResults();
                })
                .catch(err => console.error("Fehler beim Laden von autos.json:", err));

            function populateDatalists() {
                // Marken
                const marken = Array.from(new Set(autos.map(a => a.marke))).sort();
                marken.forEach(m => markenList.appendChild(new Option(m)));

                // Modelle
                const modelle = Array.from(new Set(autos.map(a => a.modell))).sort();
                modelle.forEach(m => modelleList.appendChild(new Option(m)));

                // Baujahr
                const baujahre = Array.from(new Set(autos.map(a => a.baujahr))).sort((a,b)=>a-b);
                baujahre.forEach(b => baujahrList.appendChild(new Option(b)));

                // Kraftstoff
                const kraftstoffe = Array.from(new Set(autos.map(a => a.kraftstoff).filter(k => k))).sort();
                kraftstoffe.forEach(k => kraftstoffList.appendChild(new Option(k)));
            }

            function applyInitialParams() {
                markeInput.value = params.get('marke') || '';
                modellInput.value = params.get('modell') || '';
                baujahrInput.value = params.get('baujahr') || '';
                kraftstoffInput.value = params.get('kraftstoff') || '';
            }

            function renderResults() {
                const marke = markeInput.value;
                const modell = modellInput.value;
                const baujahr = baujahrInput.value;
                const kraftstoff = kraftstoffInput.value;

                const filtered = autos.filter(auto => {
                    return (!marke || auto.marke.toLowerCase() === marke.toLowerCase()) &&
                           (!modell || auto.modell.toLowerCase() === modell.toLowerCase()) &&
                           (!baujahr || auto.baujahr == baujahr) &&
                           (!kraftstoff || auto.kraftstoff.toLowerCase() === kraftstoff.toLowerCase());
                });

                resultsUl.innerHTML = '';
                if(filtered.length === 0) {
                    resultsUl.innerHTML = '<li>Keine Autos gefunden</li>';
                } else {
                    filtered.forEach(auto => {
                        const li = document.createElement('li');
                        li.textContent = `${auto.marke} ${auto.modell} (${auto.baujahr})`;
                        li.onclick = () => window.location.href = 'details.html?id=' + auto.id;
                        resultsUl.appendChild(li);
                    });
                }
            }

            filterBtn.addEventListener('click', renderResults);
        });
    </script>
</body>
</html>
