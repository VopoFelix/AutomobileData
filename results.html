<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Suchergebnisse</title>
<style>
    body { font-family: Arial, sans-serif; margin:20px; background-color:#f0f0f5; }
    header { background-color:#333; color:white; padding:20px; text-align:center; }
    .filter-bar { background-color:white; padding:20px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin-bottom:20px; }
    input, button { padding:6px; }
    ul { list-style-type:none; padding:0; max-width:800px; margin:auto; }
    li { background-color:white; margin:10px 0; padding:15px; border-radius:8px; cursor:pointer; box-shadow:0 0 5px rgba(0,0,0,0.1); }
    li:hover { background-color:#e0e0ff; }
    button.back {
        display:block;
        margin:20px auto;
        padding:10px 20px;
        cursor:pointer;
    }
</style>
</head>
<body>
<header>
    <h1>Suchergebnisse</h1>
</header>

<button class="back" onclick="window.history.back()">Zur√ºck</button>

<div class="filter-bar">
    <input id="marke" placeholder="Marke">
    <input id="modell" placeholder="Modell">
    <input id="baujahr" placeholder="Baujahr">
    <input id="kraftstoff" placeholder="Kraftstoffart">
    <button id="filterBtn">Filtern</button>
</div>

<ul id="results"></ul>

<script>
document.addEventListener('DOMContentLoaded', () => {
    let autos = [];

    const params = new URLSearchParams(window.location.search);
    const markeInput = document.getElementById('marke');
    const modellInput = document.getElementById('modell');
    const baujahrInput = document.getElementById('baujahr');
    const kraftstoffInput = document.getElementById('kraftstoff');
    const resultsUl = document.getElementById('results');
    const filterBtn = document.getElementById('filterBtn');

    fetch('autos.json')
        .then(response => response.json())
        .then(data => {
            autos = data;
            applyInitialParams();
            renderResults();
        })
        .catch(err => console.error("Fehler beim Laden von autos.json:", err));

    function applyInitialParams() {
        markeInput.value = params.get('marke') || '';
        modellInput.value = params.get('modell') || '';
        baujahrInput.value = params.get('baujahr') || '';
        kraftstoffInput.value = params.get('kraftstoff') || '';

        updatePlaceholders();
    }

    function updatePlaceholders() {
        const selectedMarke = markeInput.value.toLowerCase();
        const filteredAutos = selectedMarke ? autos.filter(a => a.marke.toLowerCase().includes(selectedMarke)) : autos;

        const modelle = Array.from(new Set(filteredAutos.map(a => a.modell))).sort();
        modellInput.placeholder = modelle.length ? `z.B. ${modelle[0]}` : "Modell";

        const baujahre = Array.from(new Set(filteredAutos.map(a => a.baujahr))).sort((a,b)=>a-b);
        baujahrInput.placeholder = baujahre.length ? `z.B. ${baujahre[0]}` : "Baujahr";

        const kraftstoffe = Array.from(new Set(filteredAutos.map(a => a.kraftstoff).filter(k=>k))).sort();
        kraftstoffInput.placeholder = kraftstoffe.length ? `z.B. ${kraftstoffe[0]}` : "Kraftstoffart";
    }

    function renderResults() {
        const marke = markeInput.value.toLowerCase();
        const modell = modellInput.value.toLowerCase();
        const baujahr = baujahrInput.value;
        const kraftstoff = kraftstoffInput.value.toLowerCase();

        const filtered = autos.filter(auto => {
            return (!marke || auto.marke.toLowerCase().includes(marke)) &&
                   (!modell || auto.modell.toLowerCase().includes(modell)) &&
                   (!baujahr || auto.baujahr == baujahr) &&
                   (!kraftstoff || auto.kraftstoff.toLowerCase().includes(kraftstoff));
        });

        resultsUl.innerHTML = '';
        if(filtered.length === 0) {
            resultsUl.innerHTML = '<li>Keine Autos gefunden</li>';
        } else {
            filtered.forEach(auto => {
                const li = document.createElement('li');
                li.textContent = `${auto.marke} ${auto.modell} (${auto.baujahr})`;
                li.onclick = () => window.location.href = 'details.html?id=' + auto.id;
                resultsUl.appendChild(li);
            });
        }

        updatePlaceholders();
    }

    markeInput.addEventListener('input', updatePlaceholders);

    filterBtn.addEventListener('click', renderResults);
});
</script>
</body>
</html>
