<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Search Results</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f9f9f9; margin:0; padding:0; text-align:center; }
    header { background:#333; color:#fff; padding:1rem; font-size:1.5rem; }
    .search { display:flex; justify-content:center; gap:10px; margin:20px; }
    input, button, select { padding:8px; border-radius:5px; border:1px solid #ccc; }
    button { background:#333; color:#fff; cursor:pointer; }
    button:hover { background:#555; }
    .results { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; margin:20px; }
    .card { background:#fff; border:1px solid #ddd; border-radius:10px; padding:15px; width:200px; cursor:pointer; }
    .card:hover { background:#f0f0f0; }
  </style>
</head>
<body>
  <header>Search Results</header>

  <div class="search">
    <input type="text" id="brand" placeholder="Brand">
    <input type="text" id="model" placeholder="Model">
    <input type="number" id="year" placeholder="Year">
    <input type="text" id="fuel" placeholder="Fuel">
    <button onclick="searchCars()">Search</button>
  </div>

  <div>
    Sort by:
    <select id="sort" onchange="renderCars()">
      <option value="">-- None --</option>
      <option value="brand-asc">Brand A → Z</option>
      <option value="brand-desc">Brand Z → A</option>
      <option value="year-asc">Year ↑</option>
      <option value="year-desc">Year ↓</option>
      <option value="hp-asc">Horsepower ↑</option>
      <option value="hp-desc">Horsepower ↓</option>
    </select>
  </div>

  <div class="results" id="results"></div>

  <button onclick="goBack()">Back</button>

  <script>
    let cars = [];
    let filters = {};

    async function loadCars(brand) {
      if (!brand) {
        const brands = ["audi", "bmw", "mercedes", "vw"];
        let allCars = [];
        for (const b of brands) {
          const res = await fetch(`cars/${b}.json`);
          const cars = await res.json();
          allCars = allCars.concat(cars);
        }
        return allCars;
      }
      const res = await fetch(`cars/${brand.toLowerCase()}.json`);
      return await res.json();
    }

    function getParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        brand: params.get("brand"),
        model: params.get("model"),
        year: params.get("year"),
        fuel: params.get("fuel")
      };
    }

    function filterCars() {
      return cars.filter(c =>
        (!filters.brand || c.brand.toLowerCase().includes(filters.brand.toLowerCase())) &&
        (!filters.model || c.model.toLowerCase().includes(filters.model.toLowerCase())) &&
        (!filters.year || c.year == filters.year) &&
        (!filters.fuel || c.fuel.toLowerCase().includes(filters.fuel.toLowerCase()))
      );
    }

    function sortCars(list) {
      const sort = document.getElementById("sort").value;
      return list.sort((a, b) => {
        switch (sort) {
          case "brand-asc": return a.brand.localeCompare(b.brand);
          case "brand-desc": return b.brand.localeCompare(a.brand);
          case "year-asc": return a.year - b.year;
          case "year-desc": return b.year - a.year;
          case "hp-asc": return a.horsepower - b.horsepower;
          case "hp-desc": return b.horsepower - a.horsepower;
          default: return 0;
        }
      });
    }

    function renderCars() {
      const container = document.getElementById("results");
      container.innerHTML = "";

      let list = filterCars();
      list = sortCars(list);

      list.forEach(car => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<b>${car.brand} ${car.model}</b><br>
                         Year: ${car.year}<br>
                         Fuel: ${car.fuel}<br>
                         HP: ${car.horsepower}`;
        div.onclick = () => {
          window.location.href = `details.html?brand=${car.brand}&id=${car.id}`;
        };
        container.appendChild(div);
      });
    }

    function searchCars() {
      filters = {
        brand: document.getElementById("brand").value,
        model: document.getElementById("model").value,
        year: document.getElementById("year").value,
        fuel: document.getElementById("fuel").value
      };
      renderCars();
    }

    function goBack() {
      window.history.back();
    }

    (async function init() {
      filters = getParams();
      cars = await loadCars(filters.brand);
      renderCars();
    })();
  </script>
</body>
</html>
